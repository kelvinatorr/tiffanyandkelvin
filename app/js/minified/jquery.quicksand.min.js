/* Quicksand 1.4 Reorder and filter items with a nice shuffling animation. Copyright (c) 2010 Jacek Galanciak (razorjack.net) and agilope.com Big thanks for Piotr Petrus (riddle.pl) for deep code review and wonderful docs & demos. Dual licensed under the MIT and GPL version 2 licenses. http://github.com/jquery/jquery/blob/master/MIT-LICENSE.txt http://github.com/jquery/jquery/blob/master/GPL-LICENSE.txt Project site: http://razorjack.net/quicksand Github site: http://github.com/razorjack/quicksand */!function(t){var e=function(t){var e=t.clone(),i=t.find("canvas");if(i.length){var s=e.find("canvas");s.each(function(t){var e=this.getContext("2d");e.drawImage(i.get(t),0,0)})}return e};t.fn.quicksand=function(i,s){var a={duration:750,easing:"swing",attribute:"data-id",adjustHeight:"auto",adjustWidth:"auto",useScaling:!1,enhancement:function(){},selector:"> *",atomic:!1,dx:0,dy:0,maxWidth:0,retainExisting:!0},o=function(){for(var t="transform WebkitTransform MozTransform OTransform msTransform".split(" "),e=document.createElement("div"),i=0;i<t.length;i++)if("undefined"!=typeof e.style[t[i]])return!0;return!1}();t.extend(a,s),o&&"undefined"!=typeof t.fn.scale||(a.useScaling=!1);var n;return n="function"==typeof arguments[1]?arguments[1]:arguments[2],this.each(function(s){var o,r,f=[];r="function"==typeof a.attribute?t(i):e(t(i).filter("["+a.attribute+"]"));var l,h,c=t(this),p=t(this).css("height"),d=t(this).css("width"),u=!1,m=!1,y=t(c).offset(),g=[],v=t(this).find(a.selector),b=t(v).innerWidth();if(navigator.userAgent.match(/msie [6]/i))return void c.html("").append(r);var x=0,w=function(){if(t(this).css("margin","").css("position","").css("top","").css("left","").css("opacity",""),!x){if(x=1,!a.atomic){var e=c.find(a.selector);if(a.retainExisting){var i=t([]);S.find(a.selector).each(function(s){var o=t([]);if("function"==typeof a.attribute){var n=a.attribute(t(this));e.each(function(){return a.attribute(this)==n?(o=t(this),!1):void 0})}else o=e.filter("["+a.attribute+'="'+t(this).attr(a.attribute)+'"]');o.length>0&&(i=i.add(o),0===s?c.prepend(o):o.insertAfter(c.find(a.selector).get(s-1)))}),e.not(i).remove()}else c.prepend(S.find(a.selector)),e.remove();u&&c.css("height",l),m&&c.css("width",d)}a.enhancement(c),"function"==typeof n&&n.call(this)}!1===a.adjustHeight&&c.css("height","auto"),!1===a.adjustWidth&&c.css("width","auto")},W=c.offsetParent(),F=W.offset();"relative"==W.css("position")?"body"!=W.get(0).nodeName.toLowerCase()&&(F.top+=parseFloat(W.css("border-top-width"))||0,F.left+=parseFloat(W.css("border-left-width"))||0):(F.top-=parseFloat(W.css("border-top-width"))||0,F.left-=parseFloat(W.css("border-left-width"))||0,F.top-=parseFloat(W.css("margin-top"))||0,F.left-=parseFloat(W.css("margin-left"))||0),isNaN(F.left)&&(F.left=0),isNaN(F.top)&&(F.top=0),F.left-=a.dx,F.top-=a.dy,c.css("height",t(this).height()),c.css("width",t(this).width()),v.each(function(e){g[e]=t(this).offset()}),t(this).stop();var j=0,T=0;v.each(function(e){t(this).stop();var i=t(this).get(0);"absolute"==i.style.position?(j=-a.dx,T=-a.dy):(j=a.dx,T=a.dy),i.style.position="absolute",i.style.margin="0",a.adjustWidth||(i.style.width=b+"px"),i.style.top=g[e].top-parseFloat(i.style.marginTop)-F.top+T+"px",i.style.left=g[e].left-parseFloat(i.style.marginLeft)-F.left+j+"px",a.maxWidth>0&&g[e].left>a.maxWidth&&(i.style.display="none")});var S=e(t(c)),H=S.get(0);if(H.innerHTML="",H.setAttribute("id",""),H.style.height="auto",H.style.width=c.width()+"px",S.append(r),S.insertBefore(c),S.css("opacity",0),H.style.zIndex=-1,H.style.margin="0",H.style.position="absolute",H.style.top=y.top-F.top+"px",H.style.left=y.left-F.left+"px","dynamic"===a.adjustHeight?c.animate({height:S.height()},a.duration,a.easing):"auto"===a.adjustHeight&&(l=S.height(),parseFloat(p)<parseFloat(l)?c.css("height",l):u=!0),"dynamic"===a.adjustWidth?c.animate({width:S.width()},a.duration,a.easing):"auto"===a.adjustWidth&&(h=S.width(),parseFloat(d)<parseFloat(h)?c.css("width",h):m=!0),v.each(function(){var e=[];"function"==typeof a.attribute?(o=a.attribute(t(this)),r.each(function(){return a.attribute(this)==o?(e=t(this),!1):void 0})):e=r.filter("["+a.attribute+'="'+t(this).attr(a.attribute)+'"]'),f.push(e.length?a.useScaling?{element:t(this),dest:e,style:{top:t(this).offset().top,left:t(this).offset().left,opacity:""},animation:{top:e.offset().top-F.top,left:e.offset().left-F.left,opacity:1,scale:"1.0"}}:{element:t(this),dest:e,style:{top:t(this).offset().top,left:t(this).offset().left,opacity:""},animation:{top:e.offset().top-F.top,left:e.offset().left-F.left,opacity:1}}:a.useScaling?{element:t(this),style:{top:t(this).offset().top,left:t(this).offset().left,opacity:""},animation:{opacity:"0.0",scale:"0.0"}}:{element:t(this),style:{top:t(this).offset().top,left:t(this).offset().left,opacity:""},animation:{opacity:"0.0"}})}),r.each(function(){var i=[],s=[];"function"==typeof a.attribute?(o=a.attribute(t(this)),v.each(function(){return a.attribute(this)==o?(i=t(this),!1):void 0}),r.each(function(){return a.attribute(this)==o?(s=t(this),!1):void 0})):(i=v.filter("["+a.attribute+'="'+t(this).attr(a.attribute)+'"]'),s=r.filter("["+a.attribute+'="'+t(this).attr(a.attribute)+'"]'));var n;if(0===i.length&&s.length>0){n=a.useScaling?{opacity:"1.0",scale:"1.0"}:{opacity:"1.0"};var l=e(s),h=l.get(0);h.style.position="absolute",h.style.margin="0",a.adjustWidth||(h.style.width=b+"px"),h.style.top=s.offset().top-F.top+"px",h.style.left=s.offset().left-F.left+"px",l.css("opacity",0),a.useScaling&&l.scale(0),l.appendTo(c),(0===a.maxWidth||s.offset().left<a.maxWidth)&&f.push({element:t(l),dest:s,animation:n})}}),S.remove(),a.atomic){for($toDelete=c.find(a.selector),c.prepend(S.find(a.selector)),s=0;s<f.length;s++)if(f[s].dest&&f[s].style){var N=f[s].dest,A=N.offset();N.css({position:"relative",top:f[s].style.top-A.top,left:f[s].style.left-A.left}),N.animate({top:"0",left:"0"},a.duration,a.easing,w)}else f[s].element.animate(f[s].animation,a.duration,a.easing,w);$toDelete.remove()}else for(a.enhancement(c),s=0;s<f.length;s++)f[s].element.animate(f[s].animation,a.duration,a.easing,w)})}}(jQuery);